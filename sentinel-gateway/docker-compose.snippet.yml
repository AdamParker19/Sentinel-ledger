# ==============================================================================
# Sentinel Gateway - Docker Compose Configuration
# ==============================================================================
# Add this block to your existing docker-compose.yml under 'services:'
#
# This service acts as the high-performance ingestion layer, accepting
# HTTP traffic and pushing payloads to Kafka for async processing.
# ==============================================================================

sentinel-gateway:
  build:
    context: ./sentinel-gateway
    dockerfile: Dockerfile
  container_name: sentinel-gateway
  ports:
    - "3000:3000"
  environment:
    - KAFKA_BROKERS=kafka:29092
    - INGRESS_TOPIC=raw.requests
    - PORT=3000
  depends_on:
    kafka:
      condition: service_healthy
  networks:
    - sentinel-network
  restart: unless-stopped
  healthcheck:
    test: [ "CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/health" ]
    interval: 10s
    timeout: 5s
    retries: 3
    start_period: 10s
  deploy:
    resources:
      limits:
        cpus: '2'
        memory: 512M
      reservations:
        cpus: '0.5'
        memory: 128M
